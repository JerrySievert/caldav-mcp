<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 1100" width="850" height="1100">
  <defs>
    <style>
      .title { font: bold 20px sans-serif; fill: #333; }
      .node-text { font: bold 12px sans-serif; fill: #fff; text-anchor: middle; }
      .node-sub { font: 10px sans-serif; fill: rgba(255,255,255,0.85); text-anchor: middle; }
      .decision-text { font: bold 11px sans-serif; fill: #fff; text-anchor: middle; }
      .label-text { font: bold 11px sans-serif; fill: #444; }
      .yes-label { font: bold 11px sans-serif; fill: #2d6a4f; }
      .no-label { font: bold 11px sans-serif; fill: #c1292e; }
      .arrow { stroke: #444; stroke-width: 1.8; marker-end: url(#arrowhead); }
      .arrow-yes { stroke: #2d6a4f; stroke-width: 1.8; marker-end: url(#arrowhead-yes); }
      .arrow-no { stroke: #c1292e; stroke-width: 1.8; marker-end: url(#arrowhead-no); }
      .branch-label { font: bold 13px sans-serif; fill: #555; text-anchor: middle; }
    </style>

    <!-- Arrowhead markers -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#444"/>
    </marker>
    <marker id="arrowhead-yes" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2d6a4f"/>
    </marker>
    <marker id="arrowhead-no" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#c1292e"/>
    </marker>

    <!-- Drop shadow -->
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="108%">
      <feDropShadow dx="1" dy="1" stdDeviation="2" flood-opacity="0.15"/>
    </filter>

    <!-- Node gradients -->
    <linearGradient id="startGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#5a9fd4"/>
      <stop offset="100%" stop-color="#4a90d9"/>
    </linearGradient>
    <linearGradient id="processGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#6b9def"/>
      <stop offset="100%" stop-color="#5b8def"/>
    </linearGradient>
    <linearGradient id="decisionGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#f0a14a"/>
      <stop offset="100%" stop-color="#e8913a"/>
    </linearGradient>
    <linearGradient id="endGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#2ebd6a"/>
      <stop offset="100%" stop-color="#27ae60"/>
    </linearGradient>
    <linearGradient id="errorGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#f05c4c"/>
      <stop offset="100%" stop-color="#e74c3c"/>
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="850" height="1100" fill="#fafbfc" rx="8"/>

  <!-- Title -->
  <text x="425" y="35" class="title" text-anchor="middle">DELETE Flow (Object &amp; Calendar)</text>

  <!-- ============================================================ -->
  <!-- ROW 1: START  (center: x=425, y=70) -->
  <!-- ============================================================ -->
  <ellipse cx="425" cy="70" rx="100" ry="26" fill="url(#startGrad)" filter="url(#shadow)"/>
  <text x="425" y="75" class="node-text">DELETE Request</text>

  <!-- Arrow: START -> Decision OPTIONS -->
  <line x1="425" y1="96" x2="425" y2="120" class="arrow"/>

  <!-- ============================================================ -->
  <!-- ROW 2: Decision - Is method OPTIONS?  (center: 425, 160) -->
  <!-- ============================================================ -->
  <polygon points="425,120 535,160 425,200 315,160" fill="url(#decisionGrad)" filter="url(#shadow)"/>
  <text x="425" y="157" class="decision-text">Is method</text>
  <text x="425" y="170" class="decision-text">OPTIONS?</text>

  <!-- Yes branch: right -> Return 200 with DAV headers -->
  <line x1="535" y1="160" x2="720" y2="160" class="arrow-yes"/>
  <text x="560" y="153" class="yes-label">Yes</text>

  <!-- 200 + DAV headers end node (x=720, y=145, w=110, h=30) -->
  <ellipse cx="770" cy="160" rx="60" ry="22" fill="url(#endGrad)" filter="url(#shadow)"/>
  <text x="770" y="164" class="node-text" style="font-size:10px">200 + DAV hdrs</text>

  <!-- No branch: bottom -> auth_or_path_user -->
  <line x1="425" y1="200" x2="425" y2="230" class="arrow-no"/>
  <text x="438" y="218" class="no-label">No</text>

  <!-- ============================================================ -->
  <!-- ROW 3: Process - auth_or_path_user  (center: 425, y=248) -->
  <!-- ============================================================ -->
  <rect x="300" y="230" width="250" height="48" rx="6" fill="url(#processGrad)" filter="url(#shadow)"/>
  <text x="425" y="250" class="node-text">auth_or_path_user</text>
  <text x="425" y="264" class="node-sub">Basic Auth or {username} path</text>

  <!-- Arrow: auth -> Decision User resolved? -->
  <line x1="425" y1="278" x2="425" y2="296" class="arrow"/>

  <!-- ============================================================ -->
  <!-- ROW 4: Decision - User resolved?  (center: 425, 336) -->
  <!-- ============================================================ -->
  <polygon points="425,296 535,336 425,376 315,336" fill="url(#decisionGrad)" filter="url(#shadow)"/>
  <text x="425" y="333" class="decision-text">User</text>
  <text x="425" y="346" class="decision-text">resolved?</text>

  <!-- No branch: right -> 401 -->
  <line x1="535" y1="336" x2="720" y2="336" class="arrow-no"/>
  <text x="556" y="329" class="no-label">No</text>

  <ellipse cx="770" cy="336" rx="60" ry="22" fill="url(#errorGrad)" filter="url(#shadow)"/>
  <text x="770" y="340" class="node-text" style="font-size:10px">401 Unauth</text>

  <!-- Yes branch: bottom -> Decision path has uid.ics? -->
  <line x1="425" y1="376" x2="425" y2="406" class="arrow-yes"/>
  <text x="438" y="394" class="yes-label">Yes</text>

  <!-- ============================================================ -->
  <!-- ROW 5: Decision - Path has {uid}.ics?  (center: 425, 446) -->
  <!-- ============================================================ -->
  <polygon points="425,406 545,446 425,486 305,446" fill="url(#decisionGrad)" filter="url(#shadow)"/>
  <text x="425" y="443" class="decision-text">Path has</text>
  <text x="425" y="456" class="decision-text">{uid}.ics?</text>

  <!-- Yes branch (Object Delete): left column at x=210 -->
  <path d="M305,446 L210,446 L210,520" class="arrow-yes" fill="none"/>
  <text x="282" y="439" class="yes-label">Yes</text>
  <text x="210" y="505" class="branch-label">Object Delete</text>

  <!-- No branch (Calendar Delete): right column at x=640 -->
  <path d="M545,446 L640,446 L640,520" class="arrow-no" fill="none"/>
  <text x="568" y="439" class="no-label">No</text>
  <text x="640" y="505" class="branch-label">Calendar Delete</text>

  <!-- ============================================================ -->
  <!-- LEFT BRANCH: Object Delete (center x=210) -->
  <!-- ============================================================ -->

  <!-- Process: Verify calendar access  (y=520) -->
  <rect x="100" y="520" width="220" height="36" rx="6" fill="url(#processGrad)" filter="url(#shadow)"/>
  <text x="210" y="542" class="node-text">Verify calendar access</text>

  <!-- Arrow: verify -> decision belongs to user? -->
  <line x1="210" y1="556" x2="210" y2="586" class="arrow"/>

  <!-- Decision: Calendar belongs to user? (center: 210, 626) -->
  <polygon points="210,586 310,626 210,666 110,626" fill="url(#decisionGrad)" filter="url(#shadow)"/>
  <text x="210" y="623" class="decision-text">Calendar</text>
  <text x="210" y="636" class="decision-text">access OK?</text>

  <!-- No branch: left -> 403 -->
  <path d="M110,626 L40,626" class="arrow-no" fill="none"/>
  <text x="90" y="619" class="no-label">No</text>

  <ellipse cx="40" cy="626" rx="30" ry="18" fill="url(#errorGrad)" filter="url(#shadow)"/>
  <text x="40" y="630" class="node-text" style="font-size:9px">403</text>

  <!-- Yes branch: bottom -> delete object from DB -->
  <line x1="210" y1="666" x2="210" y2="696" class="arrow-yes"/>
  <text x="223" y="684" class="yes-label">Yes</text>

  <!-- Process: Delete object from DB (y=696) -->
  <rect x="100" y="696" width="220" height="36" rx="6" fill="url(#processGrad)" filter="url(#shadow)"/>
  <text x="210" y="718" class="node-text">Delete object from DB</text>

  <!-- Arrow: delete -> decision object found? -->
  <line x1="210" y1="732" x2="210" y2="762" class="arrow"/>

  <!-- Decision: Object found? (center: 210, 802) -->
  <polygon points="210,762 310,802 210,842 110,802" fill="url(#decisionGrad)" filter="url(#shadow)"/>
  <text x="210" y="799" class="decision-text">rows_affected</text>
  <text x="210" y="812" class="decision-text">&gt; 0?</text>

  <!-- No branch: left -> 404 -->
  <path d="M110,802 L40,802" class="arrow-no" fill="none"/>
  <text x="90" y="795" class="no-label">No</text>

  <ellipse cx="40" cy="802" rx="30" ry="18" fill="url(#errorGrad)" filter="url(#shadow)"/>
  <text x="40" y="806" class="node-text" style="font-size:9px">404</text>

  <!-- Yes branch: bottom -> log sync_change -->
  <line x1="210" y1="842" x2="210" y2="872" class="arrow-yes"/>
  <text x="223" y="860" class="yes-label">Yes</text>

  <!-- Process: Log sync_change "deleted" (y=872) -->
  <rect x="90" y="872" width="240" height="36" rx="6" fill="url(#processGrad)" filter="url(#shadow)"/>
  <text x="210" y="894" class="node-text">Log sync_change "deleted"</text>

  <!-- Arrow: log -> bump ctag -->
  <line x1="210" y1="908" x2="210" y2="928" class="arrow"/>

  <!-- Process: Bump ctag + sync_token (y=928) -->
  <rect x="90" y="928" width="240" height="36" rx="6" fill="url(#processGrad)" filter="url(#shadow)"/>
  <text x="210" y="950" class="node-text">Bump ctag + sync_token</text>

  <!-- Arrow: bump -> 204 end -->
  <line x1="210" y1="964" x2="210" y2="994" class="arrow"/>

  <!-- End: 204 No Content (left branch) -->
  <ellipse cx="210" cy="1016" rx="75" ry="22" fill="url(#endGrad)" filter="url(#shadow)"/>
  <text x="210" y="1020" class="node-text" style="font-size:10px">204 No Content</text>

  <!-- ============================================================ -->
  <!-- RIGHT BRANCH: Calendar Delete (center x=640) -->
  <!-- ============================================================ -->

  <!-- Process: Verify calendar access  (y=520) -->
  <rect x="530" y="520" width="220" height="36" rx="6" fill="url(#processGrad)" filter="url(#shadow)"/>
  <text x="640" y="542" class="node-text">Verify calendar access</text>

  <!-- Arrow: verify -> decision belongs to user? -->
  <line x1="640" y1="556" x2="640" y2="586" class="arrow"/>

  <!-- Decision: Calendar belongs to user? (center: 640, 626) -->
  <polygon points="640,586 740,626 640,666 540,626" fill="url(#decisionGrad)" filter="url(#shadow)"/>
  <text x="640" y="623" class="decision-text">Calendar</text>
  <text x="640" y="636" class="decision-text">access OK?</text>

  <!-- No branch: right -> 403 -->
  <path d="M740,626 L810,626" class="arrow-no" fill="none"/>
  <text x="760" y="619" class="no-label">No</text>

  <ellipse cx="810" cy="626" rx="30" ry="18" fill="url(#errorGrad)" filter="url(#shadow)"/>
  <text x="810" y="630" class="node-text" style="font-size:9px">403</text>

  <!-- Yes branch: bottom -> delete calendar -->
  <line x1="640" y1="666" x2="640" y2="696" class="arrow-yes"/>
  <text x="653" y="684" class="yes-label">Yes</text>

  <!-- Process: Delete calendar (CASCADE) (y=696) -->
  <rect x="520" y="696" width="240" height="48" rx="6" fill="url(#processGrad)" filter="url(#shadow)"/>
  <text x="640" y="716" class="node-text">Delete calendar</text>
  <text x="640" y="730" class="node-sub">CASCADE: objects + shares</text>

  <!-- Arrow: delete -> decision found? -->
  <line x1="640" y1="744" x2="640" y2="774" class="arrow"/>

  <!-- Decision: Calendar found (rows affected)? (center: 640, 814) -->
  <polygon points="640,774 740,814 640,854 540,814" fill="url(#decisionGrad)" filter="url(#shadow)"/>
  <text x="640" y="811" class="decision-text">rows_affected</text>
  <text x="640" y="824" class="decision-text">&gt; 0?</text>

  <!-- No branch: right -> 404 -->
  <path d="M740,814 L810,814" class="arrow-no" fill="none"/>
  <text x="760" y="807" class="no-label">No</text>

  <ellipse cx="810" cy="814" rx="30" ry="18" fill="url(#errorGrad)" filter="url(#shadow)"/>
  <text x="810" y="818" class="node-text" style="font-size:9px">404</text>

  <!-- Yes branch: bottom -> 204 -->
  <line x1="640" y1="854" x2="640" y2="884" class="arrow-yes"/>
  <text x="653" y="872" class="yes-label">Yes</text>

  <!-- End: 204 No Content (right branch) -->
  <ellipse cx="640" cy="906" rx="75" ry="22" fill="url(#endGrad)" filter="url(#shadow)"/>
  <text x="640" y="910" class="node-text" style="font-size:10px">204 No Content</text>

  <!-- ============================================================ -->
  <!-- LEGEND -->
  <!-- ============================================================ -->
  <g transform="translate(30, 1070)">
    <text x="0" y="0" class="label-text" style="font-size:12px">Legend:</text>

    <ellipse cx="80" cy="-4" rx="14" ry="9" fill="url(#startGrad)"/>
    <text x="100" y="0" class="label-text">Start</text>

    <rect x="135" y="-12" width="18" height="16" rx="3" fill="url(#processGrad)"/>
    <text x="158" y="0" class="label-text">Process</text>

    <polygon points="230,-12 242,-4 230,4 218,-4" fill="url(#decisionGrad)"/>
    <text x="248" y="0" class="label-text">Decision</text>

    <ellipse cx="322" cy="-4" rx="14" ry="9" fill="url(#endGrad)"/>
    <text x="342" y="0" class="label-text">Success</text>

    <ellipse cx="405" cy="-4" rx="14" ry="9" fill="url(#errorGrad)"/>
    <text x="425" y="0" class="label-text">Error</text>

    <line x1="470" y1="-4" x2="500" y2="-4" class="arrow-yes"/>
    <text x="506" y="0" class="yes-label">Yes</text>

    <line x1="540" y1="-4" x2="570" y2="-4" class="arrow-no"/>
    <text x="576" y="0" class="no-label">No</text>

    <line x1="610" y1="-4" x2="640" y2="-4" class="arrow"/>
    <text x="646" y="0" class="label-text">Flow</text>
  </g>
</svg>
